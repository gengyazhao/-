集群交换机系统CSS（Cluster Switch System），又称为集群，是指将两台支持集群特性的交换机设备组合在一起，从逻辑上组合成一台交换设备。

智能堆叠iStack(Interlligent Stack)，是指将多台支持堆叠特性的交换机设备组合在一起，从逻辑上组合成一台交换设备。

CSS与iStack的区别在于，一般框式交换机堆叠称为CSS，盒式交换机堆叠称为iStack，都可以称为堆叠。

CSS特征：
交换机多虚一：堆叠交换机对外表现为一台逻辑交换机，控制平面合一，统一管理
转发平面合一：堆叠内物理设备转发平面合一，转发信息共享并实时同步
跨设备链路聚合：跨堆叠内物理设备的链路被聚合成一个Eth-Trunk端口，和下游设备实现互联。

典型园区组网：CSS + Eth-Trunk + iStack
简单：各层设备均使用堆叠技术，逻辑设备少，网络拓扑简单，二层天然无环，无需部署xSTP破环协议。
高效：各层设备间使用eth-trunk链路聚合技术，负载分担算法灵活，链路利用率高。
可靠：堆叠技术同链路聚合技术结合使用，各层物理设备形成双归接入组网，提高整网可靠性




iStack基本概念
角色：堆叠中所有的单台交换机都称为成员交换机，按照功能不同，可以分为三种角色。
主交换机（Master）：负责管理整个堆叠。堆叠中只有一台主交换机
备交换机（Standby）：是主交换机的备份交换机。当主交换机故障时，备交换机会接替原主交换机的所有业务。堆叠中只有一台备交换机。
从交换机（Slave）：主要用于业务转发，从交换机数量越多，堆叠系统的转发能力越强。除主交换机和备交换机外，堆叠中其他所有的成员交换机都是从交换机。

堆叠ID：即成员交换机的槽位号（Slot ID），用来标识和管理成员交换机，堆叠中所有成员交换机的堆叠ID都是唯一的。

堆叠优先级：堆叠优先级是成员交换机的一个属性，主要用于角色选举过程中确定成员交换机的角色，优先级值越大表示优先级越高，优先级越高当选为主交换机的可能性越大。

堆叠建立过程：
1、使能堆叠并配置好堆叠参数
2、所有设备断电
3、连接堆叠线缆
4、所有设备上电
5、系统自动完成堆叠

交换机组建堆叠有两种方式：堆叠卡堆叠和业务口堆叠

物理成员端口：
成员交换机之间用于堆叠连接的物理端口。物理成员端口用于转发需要跨成员交换机的业务报文或成员交换机之间的堆叠协议报文。

逻辑堆叠端口
逻辑堆叠端口是专用于堆叠的逻辑端口，需要和物理成员端口绑定。堆叠的每台成员交换机上支持两个逻辑堆叠端口，分别为stack-port n/1和stack-port n/2，其中n为成员交换机的堆叠ID。


堆叠成员加入是指向已经稳定运行的堆叠系统添加一台新的交换机。
堆叠的加入过程：
1、使能堆叠并配置好新加入交换机的堆叠参数
2、新加入交换机设备断电
3、将新设备连接到堆叠系统
4、新设备上电
5、系统自动完成堆叠，新设备为堆叠从交换机

堆叠成员退出
堆叠退出的触发方式：
1、拔出堆叠线缆；
2、关闭堆叠端口或物理成员端口；
3、堆叠成员设备重启；
4、成员设备故障等其它原因

堆叠退出的处理过程
1、堆叠主设备退出：堆叠备升主，堆叠系统更新TOPO后，继续稳态运行；
2、堆叠备退出：重新选择备，堆叠系统更新TOPO后，继续稳态运行；
3、堆叠从退出：堆叠系统更新TOPO后，继续稳态运行。

堆叠分裂后的处理过程
分裂后，如果原堆叠主和堆叠备在同一个堆叠系统中，移出的成员交换机复位，重新组成堆叠；
分裂后，如果原堆叠主和堆叠备不在同一个堆叠系统中，备交换机升为主，网络中出现配置相同的两组堆叠系统。


MAD多主检测（Multi-Active Detection），是一种检测和处理堆叠分裂的协议。链路故障导致堆叠系统分裂后，MAD可以实现堆叠分裂的检测、冲突处理和故障恢复，降低堆叠分裂对业务的影响。
MAD检测方式有两种：直连检测方式和代理检测方式。在同一个堆叠系统中，两种检测方式互斥，不可以同时配置。


堆叠配置
1、通过堆叠卡连接方式组建堆叠
//配置成员交换机的堆叠优先级。缺省情况下，成员交换机的堆叠优先级为100
[SwitchA] stack slot 0 priority 200
//配置设备的堆叠ID
[SwitchB] stack slot 0 renumber 1
[SwitchC] stack slot 0 renumber 2

2、通过业务口连接方式组建堆叠
[SwitchA] interface stack-port 0/1
//配置业务口为物理成员端口并将其加入到逻辑堆叠端口中。交换机B、C同理。
[SwitchA-stack-port0/1]port interface gigabitethernet 0/0/27 enable
[SwitchA]interface stack-port 0/2
[SwitchA-stack-port0/2]port interface gigabitethernet 0/0/28 enable
//配置SwitchA的堆叠优先级为200
[SwitchA]stack slot 0 priority 200
////配置设备的堆叠ID
[SwitchB]stack slot 0 renumber 1
[SwitchC]stack slot 0 renumber 2

CSS基本概念
主交换机：负责管理整个集群。集群中只有一台主交换机。
备交换机：主交换机的备份交换机。当主交换机故障时，备交换机会接替原主交换机的所有业务。集群中只有一台备交换机。
集群ID：即CSS ID，用来标识和管理成员交换机。集群中成员交换机的集群ID是唯一的。
集群优先级：即Priority，是成员交换机的一个属性，主要用于角色选举过程中确定成员交换机的角色，优先级值越大表示优先级越高，优先级越高当选为主交换机的可能性越大。

不同于iStack可以多台设备堆叠，对于CSS集群，集群中只能有一主一备两台交换机。
